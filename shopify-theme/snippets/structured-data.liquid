{% comment %}
  JSON-LD Structured Data
  Rich snippets for search engines
{% endcomment %}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": {{ shop.name | json }},
  "url": {{ shop.url | json }},
  {% if shop.description %}
    "description": {{ shop.description | json }},
  {% endif %}
  "logo": {
    "@type": "ImageObject",
    "url": {{ settings.logo | img_url: '400x400' | prepend: 'https:' | json }}
  },
  "sameAs": [
    {% if settings.social_twitter_link != blank %}{{ settings.social_twitter_link | json }},{% endif %}
    {% if settings.social_facebook_link != blank %}{{ settings.social_facebook_link | json }},{% endif %}
    {% if settings.social_instagram_link != blank %}{{ settings.social_instagram_link | json }}{% endif %}
  ]
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": {{ shop.name | json }},
  "url": {{ shop.url | json }},
  "potentialAction": {
    "@type": "SearchAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": "{{ shop.url }}/search?q={search_term_string}"
    },
    "query-input": "required name=search_term_string"
  }
}
</script>

{% if template contains 'product' %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": {{ product.title | json }},
  "description": {{ product.description | strip_html | truncate: 200 | json }},
  "url": {{ shop.url | append: product.url | json }},
  "image": {{ product.featured_image | img_url: '1024x1024' | prepend: 'https:' | json }},
  "brand": {
    "@type": "Brand",
    "name": {{ shop.name | json }}
  },
  "offers": {
    "@type": "Offer",
    "url": {{ shop.url | append: product.url | json }},
    "priceCurrency": {{ shop.currency | json }},
    "price": {{ product.price | money_without_currency | json }},
    "availability": "{% if product.available %}https://schema.org/InStock{% else %}https://schema.org/OutOfStock{% endif %}",
    "seller": {
      "@type": "Organization",
      "name": {{ shop.name | json }}
    }
  }
  {% if product.metafields.custom.rating %}
    ,"aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": {{ product.metafields.custom.rating | json }},
      "ratingCount": {{ product.metafields.custom.review_count | default: 1 | json }}
    }
  {% endif %}
}
</script>
{% endif %}

{% if template == 'collection' %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": {{ collection.title | json }},
  "url": {{ shop.url | append: collection.url | json }},
  "description": {{ collection.description | strip_html | truncate: 200 | json }}
}
</script>
{% endif %}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": {{ shop.url | json }}
    }
    {% if template contains 'product' %}
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": {{ product.title | json }},
        "item": {{ shop.url | append: product.url | json }}
      }
    {% elsif template == 'collection' %}
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": {{ collection.title | json }},
        "item": {{ shop.url | append: collection.url | json }}
      }
    {% endif %}
  ]
}
</script>
